var FormImageCrop = function () {

    var globalURLEnlacemeConnection = 'http://localhost/www.enlaceme.com/';
    
    var CropImage = function() {
        
        var width2  = jQuery('#idCropImage').prop('naturalWidth');
        var height2 = jQuery('#idCropImage').prop('naturalHeight');
        
        $('#idCropImage').Jcrop({
            aspectRatio: 1,
            onSelect: updateCoords,
            trueSize: [width2,height2]
        });

        function updateCoords(c)
          {
            $('#crop_x').val(c.x);
            $('#crop_y').val(c.y);
            $('#crop_w').val(c.w);
            $('#crop_h').val(c.h);
          };
         
        $('#form-cropimage').submit(function(e){
            e.preventDefault();
            var data = new FormData(this);
            $.ajax({
                type: 'POST',
                url: globalURLEnlacemeConnection + 'images/cropImgProfile/',
                data: data,
                processData: false,
                contentType: false,
                beforeSend: function(){
                    if (parseInt($('#crop_w').val())){
                        return true;
                    } else {
                        alert('Please select a crop region then press submit.');
                        return false;
                    }
                    return false;
                },
                success: function(arrayResult){
                    //alert(arrayResult);
                    if(arrayResult == true){
                        $('#message_img').html('<div class="alert alert-success"><strong>Correcto!</strong> La imagen se ajusto al tamaño adecuado de la fotografía del perfil.</div>')
                            .hide()
                            .fadeIn(1000, function () {
                            setTimeout(function(sto){
                                window.location = globalURLEnlacemeConnection + 'profile/account';
                                sto.preventDefault();
                            },2000);                                
                        });                        
                    }
                }
            });            
        });

    }

    var handleResponsive = function() {
      if ($(window).width() <= 1024 && $(window).width() >= 678) {
        $('.responsive-1024').each(function(){
          $(this).attr("data-class", $(this).attr("class"));
          $(this).attr("class", 'responsive-1024 col-md-12');
        }); 
      } else {
        $('.responsive-1024').each(function(){
          if ($(this).attr("data-class")) {
            $(this).attr("class", $(this).attr("data-class"));  
            $(this).removeAttr("data-class");
          }
        });
      }
    }

    return {
        //main function to initiate the module
        init: function () {
            
            if (!jQuery().Jcrop) {;
                return;
            }

            App.addResizeHandler(handleResponsive);
            handleResponsive();
            CropImage();
        }

    };

}();

jQuery(document).ready(function() {
    FormImageCrop.init();
});